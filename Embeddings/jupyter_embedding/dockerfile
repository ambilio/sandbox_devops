FROM ubuntu:22.04

RUN apt-get update && apt-get install -y \
    curl git sudo python3 python3-pip \
    nginx bash \
    && rm -rf /var/lib/apt/lists/*

RUN useradd -m coder
RUN echo "coder ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

USER coder
WORKDIR /home/coder

RUN python3 -m pip install --upgrade pip && \
    pip install --user jupyter jupyterlab notebook

ENV PATH="/home/coder/.local/bin:${PATH}"

USER root
COPY nginx.conf /etc/nginx/sites-enabled/default
COPY start.sh /start.sh
RUN chmod +x /start.sh

EXPOSE 80
EXPOSE 8888

CMD ["/bin/bash", "/start.sh"]
