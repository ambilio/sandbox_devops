FROM python:3.11-slim

ENV PYTHONUNBUFFERED=1 \
    PORT=7860 \
    LANGFLOW_HOME=/data \
    LANGFLOW_DATABASE_URL=sqlite:////data/langflow.db

# Install system deps
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install LangFlow
RUN pip install --no-cache-dir langflow

# Create persistent directory
RUN mkdir -p /data
VOLUME ["/data"]

# Expose LangFlow port
EXPOSE 7860

# Start script
COPY start.sh /start.sh
RUN chmod +x /start.sh

CMD ["/start.sh"]
